var TcHmi;!function(e){let t;!function(t){let i;!function(i){class o extends e.Controls.System.TcHmiControl{constructor(o,n,s){super(o,n,s),this.__internalFilter=[],this.__noPayloadsFilter=[{path:"type",comparator:"!=",value:e.Server.Events.Type.Payload}],this.__internalColumns=[],this.__storageValidation={filter:{function:"getFilter",expectedResult:void 0},columns:{function:"getColumns",expectedResult:void 0}},this.__sortingInitialized=!1,this.__headerFontFamilyInitialized=!1,this.__headerFontSizeInitialized=!1,this.__headerFontSizeUnitInitialized=!1,this.__headerFontStyleInitialized=!1,this.__headerFontWeightInitialized=!1,this.__gridFontFamilyInitialized=!1,this.__gridFontSizeInitialized=!1,this.__gridFontSizeUnitInitialized=!1,this.__gridFontStyleInitialized=!1,this.__gridFontWeightInitialized=!1,this.__headerHeightInitialized=!1,this.__headerHeightUnitInitialized=!1,this.__rowHeightInitialized=!1,this.__typeToggles=new Map([[e.Server.Events.Type.Alarm,void 0],[e.Server.Events.Type.Message,void 0]]),this.__severityToggles=new Map([[e.Server.Events.Severity.Verbose,void 0],[e.Server.Events.Severity.Info,void 0],[e.Server.Events.Severity.Warning,void 0],[e.Server.Events.Severity.Error,void 0],[e.Server.Events.Severity.Critical,void 0]]),this.__menuBarButtons=new Map([["filter",void 0],["columns",void 0],["confirm",void 0],["confirmAll",void 0]]),this.__buttonTooltips={message:"Toggle displaying of messages",alarm:"Toggle displaying of alarms",verbose:"Toggle displaying of verbose events",info:"Toggle displaying of info events",warning:"Toggle displaying of warning events",error:"Toggle displaying of error events",critical:"Toggle displaying of critical events",filter:"Configure filters",columns:"Configure displayed columns",confirm:"Confirm selected alarm",confirmAll:"Confirm all unconfirmed alarms"},this.__canConfirm=!0,this.__filterPopup=null,this.__columnsPopup=null,this.__detailsPopup=null,this.__confirmAllPopup=null,this.__typesToShow=new Map([[e.Server.Events.Type.Alarm,!0],[e.Server.Events.Type.Message,!0]]),this.__severitiesToShow=new Map([[e.Server.Events.Severity.Verbose,!0],[e.Server.Events.Severity.Info,!0],[e.Server.Events.Severity.Warning,!0],[e.Server.Events.Severity.Error,!0],[e.Server.Events.Severity.Critical,!0]]),this.__themedIcons={types:new Map,severities:new Map},this.__subscriptionId=null,this.__availableColumns={severity:{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:e.Server.Events.Severity.Verbose,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/verbose.svg"},{text:"Info",value:e.Server.Events.Severity.Info,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/info.svg"},{text:"Warning",value:e.Server.Events.Severity.Warning,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/warning.svg"},{text:"Error",value:e.Server.Events.Severity.Error,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/error.svg"},{text:"Critical",value:e.Server.Events.Severity.Critical,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/critical.svg"}]},type:{name:"type",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Message",value:e.Server.Events.Type.Message,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/message.svg"},{text:"Alarm",value:e.Server.Events.Type.Alarm,height:30,width:30,source:t.getBasePathEx(this)+"/Themes/Base/Images/alarm.svg"}]},domain:{name:"domain",label:"Domain",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},sourceDomain:{name:"sourceDomain",label:"Source Domain",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},name:{name:"name",label:"Name",control:"TextBlock",width:200,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},text:{name:"text",label:"Text",control:"TextBlock",width:373,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!1,horizontalAlignment:"Left",verticalAlignment:"Center"},alarmState:{name:"alarmState",label:"",control:"TextBlock",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateRaised:{name:"timeRaised",label:"Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeRaised:{name:"timeRaised",label:"Time Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateRaised:{name:"timeRaised",label:"Date Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateConfirmed:{name:"timeConfirmed",label:"Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeConfirmed:{name:"timeConfirmed",label:"Time Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateConfirmed:{name:"timeConfirmed",label:"Date Confirmed",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateCleared:{name:"timeCleared",label:"Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeCleared:{name:"timeCleared",label:"Time Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateCleared:{name:"timeCleared",label:"Date Cleared",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"}},this.__destroyersToCallOnDetach=[],this.__onUserInGroupChangedDestroyer=null,this.__doubletapStartTime=0,this.__onUserInGroupChanged=()=>{this.__setCanConfirm(!0)},this.__onResized=()=>{"Left"!==this.__menuBarPosition&&"Right"!==this.__menuBarPosition||this.__fixVerticalMenuBarWidth()},this.__onThemeDataChanged=()=>{this.__updateThemedResources(),this.__updateColumns(this.__internalColumns)},this.__onSelectedItemChanged=()=>{this.__processSelectedItem(),e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedEvent"}),e.EventProvider.raise(this.__id+".onSelectedItemChanged",this.getSelectedEvent())},this.__onDataGridPropertyChanged=(t,i)=>{["Sorting","HeaderFontFamily","HeaderFontSize","HeaderFontSizeUnit","HeaderFontStyle","HeaderFontWeight","GridFontFamily","GridFontSize","GridFontSizeUnit","GridFontStyle","GridFontWeight","HeaderHeight","HeaderHeightUnit","RowHeight"].includes(i.propertyName)&&e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:i.propertyName})},this.__onFilterPressed=()=>{this.__filterPopup||(this.__filterPopup=new i.TcHmiEventGridPopups.FilterPopup(this.__elementFilterPopup[0],this),this.__filterPopup.registerOkButtonHandler(()=>{this.__updateFilter(this.__filterPopup.getSettings()),this.__setStoredValueWithValidation("filter",this.__internalFilter)}),this.__filterPopup.registerResetButtonHandler(()=>{var e;this.__removeStoredValue("filter"),this.__filterPopup.requiresUpdate()&&this.__filterPopup.update(null!==(e=this.__filter)&&void 0!==e?e:[],!1)})),this.__filterPopup.requiresUpdate()&&this.__filterPopup.update(this.__internalFilter,!(tchmi_equal(this.__internalFilter,this.__filter)||0===this.__internalFilter.length&&!this.__filter)),this.__filterPopup.show()},this.__onColumnsPressed=()=>{this.__columnsPopup||(this.__columnsPopup=new i.TcHmiEventGridPopups.ColumnsPopup(this.__elementColumnsPopup[0],this),this.__columnsPopup.registerOkButtonHandler(()=>{this.__updateColumns(this.__columnsPopup.getSettings()),this.__setStoredValueWithValidation("columns",this.__internalColumns)}),this.__columnsPopup.registerResetButtonHandler(()=>{var e;this.__removeStoredValue("columns"),this.__columnsPopup.requiresUpdate()&&this.__columnsPopup.update(null!==(e=this.__columns)&&void 0!==e?e:[],!1)})),this.__columnsPopup.requiresUpdate()&&this.__columnsPopup.update(this.__internalColumns,!(tchmi_equal(this.__internalColumns,this.__columns)||0===this.__internalColumns.length&&!this.__columns)),this.__columnsPopup.show()},this.__onConfirmPressed=()=>{let t=this.__datagrid.getSelectedRowValue();e.Server.Events.isAlarm(t)&&e.Server.Events.confirmAlarm(t,i=>{i.error!==e.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+"] Unable to confirm alarm with id "+t.id+" in domain "+t.domain+". Error: "+e.Log.buildMessage(i.details)),"object"==typeof i.details&&null!==i.details&&i.details.code===e.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__setCanConfirm(!1)})},this.__onConfirmAllPressed=()=>{this.__confirmAllPopup||(this.__confirmAllPopup=new i.TcHmiEventGridPopups.ConfirmAllPopup(this.__elementConfirmAllPopup[0],this));let t=new Map;t.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter()},(t,i)=>{var o;t.readValue?this.__confirmAllPopup.update(t.readValue.map(e.Server.Events.parseServerEvent).filter(e.Server.Events.isAlarm)):e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage({code:e.Errors.E_SERVER_READVALUE_MISSING,message:e.Errors[e.Errors.E_SERVER_READVALUE_MISSING],reason:"Missing property: 'readValue' in command for symbol: 'ListEvents' in response from server with id: '"+(null===(o=i.response)||void 0===o?void 0:o.id)+"'.",domain:this.__type}))}),e.Server.requestEx({requestType:"ReadWrite",commands:Array.from(t.keys())},null,this.__getServerResponseHandler(t)),this.__confirmAllPopup.update([]),this.__confirmAllPopup.show()},this.__onDoubleclick=t=>{if(!this.getIsEnabled())return;if(!e.Access.checkAccess(this,"operate")||!e.Access.checkAccess(this,"viewDetails"))return;if(!(t.target instanceof Element))return;let i=t.target;for(;i&&!i.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")&&!i.classList.contains("tchmi-datagrid-template-row");)i=i.parentElement;i&&(e.EventProvider.raise(this.__id+".onItemDoubleClicked",this.getSelectedEvent()),this.__showDetails())},this.__onTouchStart=t=>{if(!this.getIsEnabled())return;if(!e.Access.checkAccess(this,"operate")||!e.Access.checkAccess(this,"viewDetails"))return;if(!(t.target instanceof Element))return;let i=t.target;for(;i&&(!i.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")||!i.classList.contains("tchmi-datagrid-template-row"));)i=i.parentElement;let o=Date.now();i&&(o-this.__doubletapStartTime<300?(e.EventProvider.raise(this.__id+".onItemDoubleClicked",this.getSelectedEvent()),this.__showDetails(),this.__doubletapStartTime=0,t.preventDefault()):this.__doubletapStartTime=o)},this.__onScroll=t=>{this.getIsEnabled()&&e.Access.checkAccess(this,"operate")&&e.Access.checkAccess(this,"viewDetails")&&(this.__doubletapStartTime=0)},this.__onResolverForColumnsWatchCallback=t=>{!1===this.__isAttached&&this.__suspendObjectResolver("columns"),t.error===e.Errors.NONE?tchmi_equal(t.value,this.__columns)||(this.__columns=t.value,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Columns"}),this.__processColumns()):TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+", Attribute=Columns] Resolving symbols from object failed with error: "+e.Log.buildMessage(t.details))},this.__onResolverForFilterWatchCallback=t=>{!1===this.__isAttached&&this.__suspendObjectResolver("filter"),t.error===e.Errors.NONE?tchmi_equal(t.value,this.__filter)||(this.__filter=t.value,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Filter"}),this.__processFilter()):TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+", Attribute=Filter] Resolving symbols from object failed with error: "+e.Log.buildMessage(t.details))}}__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-event-grid-template")),this.__elementGridContainer=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-grid-container"),0===this.__elementGridContainer.length&&(this.__elementGridContainer=this.__elementTemplateRoot.find(".tchmi-event-grid-template-grid-container")),this.__elementMenuBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-menu-bar"),0===this.__elementMenuBar.length&&(this.__elementMenuBar=this.__elementTemplateRoot.find(".tchmi-event-grid-template-menu-bar")),this.__elementTypeToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-type-toggles"),0===this.__elementTypeToggles.length&&(this.__elementTypeToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-type-toggles")),this.__elementSeverityToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-severity-toggles"),0===this.__elementSeverityToggles.length&&(this.__elementSeverityToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-severity-toggles")),this.__elementOptions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-options"),0===this.__elementOptions.length&&(this.__elementOptions=this.__elementMenuBar.find(".tchmi-event-grid-template-options")),this.__elementMessageActions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-event-actions"),0===this.__elementMessageActions.length&&(this.__elementMessageActions=this.__elementMenuBar.find(".tchmi-event-grid-template-event-actions")),this.__elementFilterPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-popup"),0===this.__elementFilterPopup.length&&(this.__elementFilterPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-filter-popup")),this.__elementColumnsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-popup"),0===this.__elementColumnsPopup.length&&(this.__elementColumnsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-columns-popup")),this.__elementDetailsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-details-popup"),0===this.__elementDetailsPopup.length&&(this.__elementDetailsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-details-popup")),this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup"),0===this.__elementConfirmAllPopup.length&&(this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-confirm-all-popup")),0===this.__elementTemplateRoot.length||0===this.__elementGridContainer.length||0===this.__elementMenuBar.length||0===this.__elementTypeToggles.length||0===this.__elementSeverityToggles.length||0===this.__elementOptions.length||0===this.__elementMessageActions.length||0===this.__elementFilterPopup.length||0===this.__elementColumnsPopup.length||0===this.__elementDetailsPopup.length||0===this.__elementConfirmAllPopup.length)throw new Error("Invalid Template.html");let t=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",this.__id+".eventDatagrid",{"data-tchmi-width":100,"data-tchmi-width-unit":"%","data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-row-classes-provider":{objectType:"Function",active:!0,fn:"EventClassesProvider",fnParams:[]},"data-tchmi-cell-content-padding":{left:3,right:3}},this);if(!t)throw new Error("Could not create controls for TcHmiEventGrid.");t.__setDataSymbolTransform(e.Server.Events.parseServerEvent),t.setDataSymbol(new e.Symbol("%s%ListEvents%/s%")),this.__datagrid=t,super.__previnit()}__init(){super.__init(),this.__initStorage(),this.__onUserInGroupChangedDestroyer=e.EventProvider.register("onUserInGroupChanged",this.__onUserInGroupChanged),this.__elementGridContainer.append(this.__datagrid.getElement());for(const i of this.__typeToggles.keys()){let o=e.Server.Events.Type[i].toLowerCase(),n=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}.${o}ToggleButton`,{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[o],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight,"data-tchmi-icon":`${t.getBasePathEx(this)}/Themes/Base/Images/${o}.svg`,"data-tchmi-icon-width":30,"data-tchmi-icon-height":30,"data-tchmi-icon-horizontal-alignment":"Left"},this);if(!n)throw new Error("Could not create controls for TcHmiEventGrid.");let s=n.getElement();s.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${o.toLowerCase()}-toggle-button`),s.addClass(`tchmi-event-grid-template-${o.toLowerCase()}-toggle-button`),this.__typeToggles.set(i,n),this.__elementTypeToggles.append(s)}for(const i of this.__severityToggles.keys()){let o=e.Server.Events.Severity[i].toLowerCase(),n=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}.${o}ToggleButton`,{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[o],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight,"data-tchmi-icon":`${t.getBasePathEx(this)}/Themes/Base/Images/${o}.svg`,"data-tchmi-icon-width":30,"data-tchmi-icon-height":30,"data-tchmi-icon-horizontal-alignment":"Left"},this);if(!n)throw new Error("Could not create controls for TcHmiEventGrid.");let s=n.getElement();s.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${o.toLowerCase()}-toggle-button`),s.addClass(`tchmi-event-grid-template-${o.toLowerCase()}-toggle-button`),this.__severityToggles.set(i,n),this.__elementSeverityToggles.append(s)}for(const t of this.__menuBarButtons.keys()){let i=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}.${t}Button`,{"data-tchmi-width":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-tooltip":this.__buttonTooltips[t]},this);if(!i)throw new Error("Could not create controls for TcHmiEventGrid.");let o=i.getElement();o.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${t.toLowerCase()}-button`),o.addClass(`tchmi-event-grid-template-${t.toLowerCase()}-button`),this.__menuBarButtons.set(t,i),"confirm"===t||"confirmAll"===t?(i.setIsEnabled(!1),this.__elementMessageActions.append(o)):this.__elementOptions.append(o)}let i=[{controlRight:"operate",virtualControlRight:"configure"}],o=this.__menuBarButtons.get("columns");o&&o.setVirtualControlRightMappings(i)}__attach(){super.__attach(),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__id+".onResized",this.__onResized)),this.__destroyersToCallOnDetach.push(e.EventProvider.register("onThemeDataChanged",this.__onThemeDataChanged));for(const[t,i]of this.__typeToggles)this.__destroyersToCallOnDetach.push(e.EventProvider.register(i.getId()+".onToggleStateChanged",this.__getTypeToggleStateChangedHandler(i,t)));for(const[t,i]of this.__severityToggles)this.__destroyersToCallOnDetach.push(e.EventProvider.register(i.getId()+".onToggleStateChanged",this.__getSeverityToggleStateChangedHandler(i,t)));this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__datagrid.getId()+".onPropertyChanged<selectedRowValue>",this.__onSelectedItemChanged)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__datagrid.getId()+".onPropertyChanged",this.__onDataGridPropertyChanged)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.get("filter").getId()+".onPressed",this.__onFilterPressed)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.get("columns").getId()+".onPressed",this.__onColumnsPressed)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.get("confirm").getId()+".onPressed",this.__onConfirmPressed)),this.__destroyersToCallOnDetach.push(e.EventProvider.register(this.__menuBarButtons.get("confirmAll").getId()+".onPressed",this.__onConfirmAllPressed)),this.__elementGridContainer[0].addEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].addEventListener("touchstart",this.__onTouchStart),this.__elementGridContainer[0].addEventListener("scroll",this.__onScroll,!0),this.__updateThemedResources();let t=this.__getStoredValue("filter");t?this.__updateFilter(t):this.__processFilter();let i=this.__getStoredValue("columns");i?this.__updateColumns(i):this.__processColumns()}__detach(){super.__detach();for(let e=0,t=this.__destroyersToCallOnDetach.length;e<t;e++)this.__destroyersToCallOnDetach[e]();this.__destroyersToCallOnDetach=[],this.__elementGridContainer[0].removeEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].removeEventListener("touchstart",this.__onTouchStart),this.__elementGridContainer[0].removeEventListener("scroll",this.__onScroll)}destroy(){this.__keepAlive||(super.destroy(),this.__onUserInGroupChangedDestroyer&&(this.__onUserInGroupChangedDestroyer(),this.__onUserInGroupChangedDestroyer=null),this.__filterPopup&&(this.__filterPopup.destroy(),this.__filterPopup=null),this.__columnsPopup&&(this.__columnsPopup.destroy(),this.__columnsPopup=null),this.__detailsPopup&&(this.__detailsPopup.destroy(),this.__detailsPopup=null),this.__confirmAllPopup&&(this.__confirmAllPopup.destroy(),this.__confirmAllPopup=null))}__getTypeToggleStateChangedHandler(e,t){return()=>{this.__typesToShow.set(t,"Active"===e.getToggleState()),this.__updateDatagridFilter()}}__getSeverityToggleStateChangedHandler(e,t){return()=>{this.__severitiesToShow.set(t,"Active"===e.getToggleState()),this.__updateDatagridFilter()}}__showDetails(){this.__allowDetailsPopup&&(this.__detailsPopup||(this.__detailsPopup=new i.TcHmiEventGridPopups.DetailsPopup(this.__elementDetailsPopup[0],this)),this.__detailsPopup.update(this.__datagrid.getSelectedRowValue()),this.__detailsPopup.show())}__processSelectedItem(){let t=this.__datagrid.getSelectedRowValue();null===t?(this.__menuBarButtons.get("confirm").setIsEnabled(!1),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.hide()):(this.__menuBarButtons.get("confirm").setIsEnabled(e.Server.Events.isAlarm(t)&&t.confirmationState===e.Server.Events.ConfirmationState.WaitForConfirmation),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.update(t))}__updateSubscription(){var t;if(TCHMI_DESIGNER)return;null!==this.__subscriptionId&&e.Server.unsubscribeEx(this.__subscriptionId,null,t=>{t.error!==e.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage(t.details))}),this.__subscriptionId=null;let i=this.__getToggleButtonCommands(),[o,n]=this.__getConfirmAllCommand();i.set(o,n),i.size>0&&(this.__subscriptionId=e.Server.subscribeEx(Array.from(i.keys()),null!==(t=e.System.config.tcHmiServer.websocketIntervalTime)&&void 0!==t?t:500,null,this.__getServerResponseHandler(i)))}__getServerResponseHandler(t){const i=["symbol","customerData","writeValue","filter","orderBy","limit","offset"];return o=>{if(o.error===e.Errors.NONE)if(o.response)if(o.response.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage(o.response.error));else if(o.response.commands&&0!==o.response.commands.length)for(const n of o.response.commands)if(n.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage(o.response.commands[0].error));else for(const[e,s]of t){let t=!0;for(let o in e)if(i.includes(o)&&!tchmi_equal(e[o],n[o])){t=!1;break}if(t){s(n,o);break}}else e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage({code:e.Errors.E_SERVER_COMMANDS_MISSING,message:e.Errors[e.Errors.E_SERVER_COMMANDS_MISSING],reason:"Missing commands in response from server with id: '"+o.response.id+"'.",domain:this.__type}));else e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage({code:e.Errors.E_SERVER_RESPONSE_MISSING,message:e.Errors[e.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+e.Log.buildMessage(o.details))}}__getToggleButtonCommands(){let e=new Map;function t(e){return(t,i)=>{e.setText(t.maxEntries?t.maxEntries.toString():"0")}}for(const[i,o]of this.__typeToggles){if(!o)continue;let n={path:"type",comparator:"==",value:i},s=0===this.__internalFilter.length?[n]:[n,{logic:"AND"},this.__internalFilter];e.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",limit:0,filter:s},t(o))}for(const[i,o]of this.__severityToggles){if(!o)continue;let n={path:"severity",comparator:"==",value:i},s=0===this.__noPayloadsFilter.length?[n]:[n,{logic:"AND"},this.__noPayloadsFilter];e.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",limit:0,filter:s},t(o))}return e}__getConfirmAllCommand(){return[{commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter(),limit:0},(e,t)=>{var i,o;null===(i=this.__menuBarButtons.get("confirmAll"))||void 0===i||i.setIsEnabled((null!==(o=e.maxEntries)&&void 0!==o?o:0)>0)}]}__getConfirmAllFilter(){let t=[{path:"type",comparator:"==",value:e.Server.Events.Type.Alarm},{logic:"AND"},{path:"confirmationState",comparator:"==",value:e.Server.Events.ConfirmationState.WaitForConfirmation}];return 0!==this.__internalFilter.length&&t.push({logic:"AND"},this.__internalFilter),t}__initStorage(){let e=window.localStorage.getItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id);if(e)try{this.__storage=JSON.parse(e),"object"!=typeof this.__storage&&(this.__storage={})}catch(e){this.__storage={}}else this.__storage={};for(let e in this.__storageValidation)this.__storageValidation[e].expectedResult=this[this.__storageValidation[e].function].apply(this);for(let e in this.__storage)tchmi_equal(this.__storageValidation[e].expectedResult,this.__storage[e].validation.expectedResult)||this.__removeStoredValue(e)}__getStoredValue(t){this.__storage||this.__initStorage();let i=e.Server.getCurrentUser(),o=this.__storage[t];if(o)return i?o.users?o.users[i]:void 0:o.anonymousUser}__setStoredValueWithValidation(t,i){var o;this.__storage||this.__initStorage();let n=e.Server.getCurrentUser(),s=tchmi_equal(i,this.__storageValidation[t].expectedResult);if(!this.__storage[t]){if(s)return;this.__storage[t]={validation:{function:this.__storageValidation[t].function,expectedResult:void 0}}}let r=this.__storage[t];if(r.validation.expectedResult=this.__storageValidation[t].expectedResult,n){if(!(null===(o=r.users)||void 0===o?void 0:o[n])&&s)return;r.users||(r.users={}),r.users[n]=i}else{if(void 0===r.anonymousUser&&s)return;r.anonymousUser=i}try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(e){}}__removeStoredValue(t){this.__storage||this.__initStorage();let i=this.__storage[t];if(i){let o=e.Server.getCurrentUser();o?i.users?(delete i.users[o],0===Object.keys(i.users).length&&(void 0===i.anonymousUser?delete this.__storage[t]:delete i.users)):void 0===i.anonymousUser&&delete this.__storage[t]:i.users?delete i.anonymousUser:delete this.__storage[t]}if(Object.keys(this.__storage).length>0)try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(e){}else window.localStorage.removeItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id)}__updateThemedResources(){this.__themedIcons=this.__getThemedIcons();let t=(e,t,i)=>{t?(e.setIcon(t.imagePath),e.setIconWidth(t.width),e.setIconHeight(t.height)):(e.setIcon(`Themes/Base/Images/${i}.svg`),e.setIconWidth(30),e.setIconHeight(30))};for(const[i,o]of this.__typeToggles)o&&t(o,this.__themedIcons.types.get(i),e.Server.Events.Type[i].toLowerCase());for(const[i,o]of this.__severityToggles)o&&t(o,this.__themedIcons.severities.get(i),e.Server.Events.Severity[i].toLowerCase())}__getThemedIcons(){let t=t=>{let i=e.Theme.Resources.get(this,t);return i.error===e.Errors.NONE&&i.value?(i.value.imagePath=e.Theme.Resources.resolveBasePath(this,i)+i.value.imagePath,i.value):null},i={types:new Map,severities:new Map};return i.types.set(e.Server.Events.Type.Message,t("MessageIcon")),i.types.set(e.Server.Events.Type.Alarm,t("AlarmIcon")),i.severities.set(e.Server.Events.Severity.Verbose,t("VerboseIcon")),i.severities.set(e.Server.Events.Severity.Info,t("InfoIcon")),i.severities.set(e.Server.Events.Severity.Warning,t("WarningIcon")),i.severities.set(e.Server.Events.Severity.Error,t("ErrorIcon")),i.severities.set(e.Server.Events.Severity.Critical,t("CriticalIcon")),i}setColumns(valueNew){let t=e.ValueConverter.toObject(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Columns"));let i=this.__objectResolvers.get("columns");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());let o=new e.Symbol.ObjectResolver(t);this.__objectResolvers.set("columns",{resolver:o,watchCallback:this.__onResolverForColumnsWatchCallback,watchDestroyer:o.watch(this.__onResolverForColumnsWatchCallback)})}getColumns(){return this.__columns}__processColumns(){var e;this.__updateColumns(null!==(e=this.__columns)&&void 0!==e?e:[])}__updateColumns(e){this.__internalColumns=e;let t=e.map(e=>{let t;return t=this.__availableColumns[e.columnName]?tchmi_clone_object(this.__availableColumns[e.columnName]):{name:e.columnName,label:void 0!==e.label&&null!==e.label?e.label:e.columnName,control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:50,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},void 0!==e.width&&(t.width=e.width,e.widthUnit&&(t.widthUnit=e.widthUnit)),"type"!==t.name&&"severity"!==t.name||!t.dataDefinitions||t.dataDefinitions.forEach(e=>{let i="type"===t.name?this.__themedIcons.types.get(e.value):this.__themedIcons.severities.get(e.value);i&&(e.source=i.imagePath,e.width=i.width,e.height=i.height)}),t.sortable&&void 0!==e.sortable&&(t.sortable=e.sortable),t});this.__datagrid.setSrcColumn(t)}setFilter(valueNew){let t=e.ValueConverter.toObject(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("Filter"));let i=this.__objectResolvers.get("filter");i&&(i.watchDestroyer&&i.watchDestroyer(),i.resolver.destroy());let o=new e.Symbol.ObjectResolver(t);this.__objectResolvers.set("filter",{resolver:o,watchCallback:this.__onResolverForFilterWatchCallback,watchDestroyer:o.watch(this.__onResolverForFilterWatchCallback)})}getFilter(){return this.__filter}__processFilter(){var e;this.__updateFilter(null!==(e=this.__filter)&&void 0!==e?e:[])}__updateFilter(t){this.__isAttached&&(this.__internalFilter=t,this.__noPayloadsFilter=[{path:"type",comparator:"!=",value:e.Server.Events.Type.Payload}],0!==t.length&&this.__noPayloadsFilter.push({logic:"AND"},t),this.__updateDatagridFilter(),this.__updateSubscription())}__updateDatagridFilter(){let e=[];for(const[t,i]of this.__typesToShow)i||(0!==e.length&&e.push({logic:"AND"}),e.push({path:"type",comparator:"!=",value:t}));for(const[t,i]of this.__severitiesToShow)i||(0!==e.length&&e.push({logic:"AND"}),e.push({path:"severity",comparator:"!=",value:t}));let t=0===e.length?this.__noPayloadsFilter:[e,{logic:"AND"},this.__noPayloadsFilter];this.__datagrid.setFilter(t)}setSorting(valueNew){this.__datagrid.setSorting(valueNew),this.__sortingInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Sorting"}),this.__sortingInitialized=!0)}getSorting(){return this.__sortingInitialized?this.__datagrid.getSorting():void 0}setHeaderFontFamily(valueNew){this.__datagrid.setHeaderFontFamily(valueNew),this.__headerFontFamilyInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontFamily"}),this.__headerFontFamilyInitialized=!0)}getHeaderFontFamily(){return this.__headerFontFamilyInitialized?this.__datagrid.getHeaderFontFamily():void 0}setHeaderFontSize(valueNew){this.__datagrid.setHeaderFontSize(valueNew),this.__headerFontSizeInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontSize"}),this.__headerFontSizeInitialized=!0)}getHeaderFontSize(){return this.__headerFontSizeInitialized?this.__datagrid.getHeaderFontSize():void 0}setHeaderFontSizeUnit(valueNew){this.__datagrid.setHeaderFontSizeUnit(valueNew),this.__headerFontSizeUnitInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontSizeUnit"}),this.__headerFontSizeUnitInitialized=!0)}getHeaderFontSizeUnit(){return this.__headerFontSizeUnitInitialized?this.__datagrid.getHeaderFontSizeUnit():void 0}setHeaderFontStyle(valueNew){this.__datagrid.setHeaderFontStyle(valueNew),this.__headerFontStyleInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontStyle"}),this.__headerFontStyleInitialized=!0)}getHeaderFontStyle(){return this.__headerFontStyleInitialized?this.__datagrid.getHeaderFontStyle():void 0}setHeaderFontWeight(valueNew){this.__datagrid.setHeaderFontWeight(valueNew),this.__headerFontWeightInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontWeight"}),this.__headerFontWeightInitialized=!0)}getHeaderFontWeight(){return this.__headerFontWeightInitialized?this.__datagrid.getHeaderFontWeight():void 0}setGridFontFamily(valueNew){this.__datagrid.setGridFontFamily(valueNew),this.__datagrid.setRowNumbersFontFamily(valueNew),this.__gridFontFamilyInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontFamily"}),this.__gridFontFamilyInitialized=!0)}getGridFontFamily(){return this.__gridFontFamilyInitialized?this.__datagrid.getGridFontFamily():void 0}setGridFontSize(valueNew){this.__datagrid.setGridFontSize(valueNew),this.__datagrid.setRowNumbersFontSize(valueNew),this.__gridFontSizeInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontSize"}),this.__gridFontSizeInitialized=!0)}getGridFontSize(){return this.__gridFontSizeInitialized?this.__datagrid.getGridFontSize():void 0}setGridFontSizeUnit(valueNew){this.__datagrid.setGridFontSizeUnit(valueNew),this.__datagrid.setRowNumbersFontSizeUnit(valueNew),this.__gridFontSizeUnitInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontSizeUnit"}),this.__gridFontSizeUnitInitialized=!0)}getGridFontSizeUnit(){return this.__gridFontSizeUnitInitialized?this.__datagrid.getGridFontSizeUnit():void 0}setGridFontStyle(valueNew){this.__datagrid.setGridFontStyle(valueNew),this.__datagrid.setRowNumbersFontStyle(valueNew),this.__gridFontStyleInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontStyle"}),this.__gridFontStyleInitialized=!0)}getGridFontStyle(){return this.__gridFontStyleInitialized?this.__datagrid.getGridFontStyle():void 0}setGridFontWeight(valueNew){this.__datagrid.setGridFontWeight(valueNew),this.__datagrid.setRowNumbersFontWeight(valueNew),this.__gridFontWeightInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontWeight"}),this.__gridFontWeightInitialized=!0)}getGridFontWeight(){return this.__gridFontWeightInitialized?this.__datagrid.getGridFontWeight():void 0}setHeaderHeight(valueNew){this.__datagrid.setHeaderHeight(valueNew),this.__headerHeightInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderHeight"}),this.__headerHeightInitialized=!0)}getHeaderHeight(){return this.__headerHeightInitialized?this.__datagrid.getHeaderHeight():void 0}setHeaderHeightUnit(valueNew){this.__datagrid.setHeaderHeightUnit(valueNew),this.__headerHeightUnitInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderHeightUnit"}),this.__headerHeightUnitInitialized=!0)}getHeaderHeightUnit(){return this.__headerHeightUnitInitialized?this.__datagrid.getHeaderHeightUnit():void 0}setRowHeight(valueNew){this.__datagrid.setRowHeight(valueNew),this.__rowHeightInitialized||(e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"RowHeight"}),this.__rowHeightInitialized=!0)}getRowHeight(){return this.__rowHeightInitialized?this.__datagrid.getRowHeight():void 0}getRowHeightUnit(){return"px"}setAllowDetailsPopup(valueNew){let t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("AllowDetailsPopup")),t!==this.__allowDetailsPopup&&(this.__allowDetailsPopup=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowDetailsPopup"}),this.__processAllowDetailsPopup())}getAllowDetailsPopup(){return this.__allowDetailsPopup}__processAllowDetailsPopup(){}setShowMenuBar(valueNew){let t=e.ValueConverter.toBoolean(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ShowMenuBar")),t!==this.__showMenuBar&&(this.__showMenuBar=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowMenuBar"}),this.__processShowMenuBar())}getShowMenuBar(){return this.__showMenuBar}__processShowMenuBar(){this.__showMenuBar?(e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display",null),this.__fixVerticalMenuBarWidth()):e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display","none")}setMenuBarPosition(valueNew){let t=e.ValueConverter.toString(valueNew);(null===t||"Top"!==t&&"Bottom"!==t&&"Left"!==t&&"Right"!==t)&&(t=this.getAttributeDefaultValueInternal("MenuBarPosition")),t!==this.__menuBarPosition&&(this.__menuBarPosition=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"MenuBarPosition"}),this.__processMenuBarPosition())}getMenuBarPosition(){return this.__menuBarPosition}__processMenuBarPosition(){switch(this.__menuBarPosition){case"Top":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction",null),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Bottom":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","column-reverse"),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Left":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row"),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column");break;case"Right":e.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row-reverse"),e.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column")}this.__fixVerticalMenuBarWidth()}setButtonFontFamily(valueNew){let t=e.ValueConverter.toString(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontFamily")),t!==this.__buttonFontFamily&&(this.__buttonFontFamily=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontFamily"}),this.__processButtonFontFamily())}getButtonFontFamily(){return this.__buttonFontFamily}__processButtonFontFamily(){var e,t;for(const t of this.__typeToggles.values())t&&t.setTextFontFamily(null!==(e=this.__buttonFontFamily)&&void 0!==e?e:null);for(const e of this.__severityToggles.values())e&&e.setTextFontFamily(null!==(t=this.__buttonFontFamily)&&void 0!==t?t:null)}setButtonFontSize(valueNew){let t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontSize")),t!==this.__buttonFontSize&&(this.__buttonFontSize=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontSize"}),this.__processButtonFontSize())}getButtonFontSize(){return this.__buttonFontSize}__processButtonFontSize(){var e,t;for(const t of this.__typeToggles.values())t&&t.setTextFontSize(null!==(e=this.__buttonFontSize)&&void 0!==e?e:null);for(const e of this.__severityToggles.values())e&&e.setTextFontSize(null!==(t=this.__buttonFontSize)&&void 0!==t?t:null)}setButtonFontSizeUnit(valueNew){let t=e.ValueConverter.toDimensionUnit(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontSizeUnit")),t!==this.__buttonFontSizeUnit&&(this.__buttonFontSizeUnit=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontSizeUnit"}),this.__processButtonFontSizeUnit())}getButtonFontSizeUnit(){return this.__buttonFontSizeUnit}__processButtonFontSizeUnit(){var e,t;for(const t of this.__typeToggles.values())t&&t.setTextFontSizeUnit(null!==(e=this.__buttonFontSizeUnit)&&void 0!==e?e:null);for(const e of this.__severityToggles.values())e&&e.setTextFontSizeUnit(null!==(t=this.__buttonFontSizeUnit)&&void 0!==t?t:null)}setButtonFontStyle(valueNew){let t=e.ValueConverter.toFontStyle(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontStyle")),t!==this.__buttonFontStyle&&(this.__buttonFontStyle=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontStyle"}),this.__processButtonFontStyle())}getButtonFontStyle(){return this.__buttonFontStyle}__processButtonFontStyle(){var e,t;for(const t of this.__typeToggles.values())t&&t.setTextFontStyle(null!==(e=this.__buttonFontStyle)&&void 0!==e?e:null);for(const e of this.__severityToggles.values())e&&e.setTextFontStyle(null!==(t=this.__buttonFontStyle)&&void 0!==t?t:null)}setButtonFontWeight(valueNew){let t=e.ValueConverter.toFontWeight(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonFontWeight")),t!==this.__buttonFontWeight&&(this.__buttonFontWeight=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontWeight"}),this.__processButtonFontWeight())}getButtonFontWeight(){return this.__buttonFontWeight}__processButtonFontWeight(){var e,t;for(const t of this.__typeToggles.values())t&&t.setTextFontWeight(null!==(e=this.__buttonFontWeight)&&void 0!==e?e:null);for(const e of this.__severityToggles.values())e&&e.setTextFontWeight(null!==(t=this.__buttonFontWeight)&&void 0!==t?t:null)}setButtonHeight(valueNew){let t=e.ValueConverter.toNumber(valueNew);null===t&&(t=this.getAttributeDefaultValueInternal("ButtonHeight")),t!==this.__buttonHeight&&(this.__buttonHeight=t,e.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonHeight"}),this.__processButtonHeight())}getButtonHeight(){return this.__buttonHeight}__processButtonHeight(){var e,t,i,o;for(const t of this.__typeToggles.values())t&&(t.setHeight(null!==(e=this.__buttonHeight)&&void 0!==e?e:null),t.setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(const e of this.__severityToggles.values())e&&(e.setHeight(null!==(t=this.__buttonHeight)&&void 0!==t?t:null),e.setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(const e of this.__menuBarButtons.values())e&&(e.setHeight(null!==(i=this.__buttonHeight)&&void 0!==i?i:null),e.setWidth(null!==(o=this.__buttonHeight)&&void 0!==o?o:null));this.__fixVerticalMenuBarWidth()}getButtonHeightUnit(){return"px"}__fixVerticalMenuBarWidth(){let t=this.__elementMenuBar.add(this.__elementMenuBar.children());if(e.StyleProvider.setSimpleElementStyle(t,"min-width",null),"Left"===this.__menuBarPosition||"Right"===this.__menuBarPosition)for(let i=t.length-1;i>=0;i--){let o=t[i].lastElementChild;if(o){let n=o.getBoundingClientRect().right-t[i].getBoundingClientRect().left;e.StyleProvider.setSimpleElementStyle(t[i],"min-width",n+"px")}}}getSelectedEvent(){return this.__datagrid?this.__datagrid.getSelectedRowValue():null}__processIsEnabled(){super.__processIsEnabled(),this.getIsEnabled()||this.__hideAllPopups()}__processAccessConfig(){super.__processAccessConfig(),!1!==e.Access.checkAccess(this,"operate")&&!1!==e.Access.checkAccess(this,"observe")||this.__hideAllPopups(),e.Access.checkAccess(this,"configure")||(this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide()),e.Access.checkAccess(this,"viewDetails")||this.__detailsPopup&&this.__detailsPopup.hide()}__hideAllPopups(){this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide(),this.__detailsPopup&&this.__detailsPopup.hide(),this.__confirmAllPopup&&this.__confirmAllPopup.hide()}__setCanConfirm(e){this.__canConfirm=e,this.__detailsPopup&&this.__detailsPopup.__setCanConfirm(e),this.__menuBarButtons.get("confirm").getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!e),this.__menuBarButtons.get("confirmAll").getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!e),this.__menuBarButtons.get("confirm").getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!e),this.__menuBarButtons.get("confirmAll").getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!e),this.__menuBarButtons.get("confirm").setIsEnabled(e),this.__menuBarButtons.get("confirmAll").setIsEnabled(e)}__getCanConfirm(){return this.__canConfirm}}i.TcHmiEventGrid=o}(i=t.Beckhoff||(t.Beckhoff={})),t.registerEx("TcHmiEventGrid","TcHmi.Controls.Beckhoff",e.Controls.Beckhoff.TcHmiEventGrid)}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let i;!function(t){let i;!function(t){t.Popup=class{constructor(e,t,i){if(this.__eventDestroyers=[],this.__isShowing=!1,this.__name=t,this.__parentControl=i,this.__element=e,this.__elementContent=e.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-content")[0],this.__elementFooter=e.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-footer")[0],!this.__element||!this.__elementContent||!this.__elementFooter)throw new Error("Invalid Template.html")}show(){this.__isShowing||(e.TopMostLayer.add(this.__parentControl,$(this.__element),{removeCb:()=>{this.__isShowing=!1},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)}hide(){this.__isShowing&&(e.TopMostLayer.remove(this.__parentControl,$(this.__element)),this.__isShowing=!1)}destroy(){for(let e=0,t=this.__eventDestroyers.length;e<t;e++)this.__eventDestroyers[e]()}isShowing(){return this.__isShowing}}}(i=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(i=t.Beckhoff||(t.Beckhoff={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let i;!function(t){let i;!function(t){class i extends t.Popup{constructor(t,i,o){super(t,i,o),this.__resetHandlers=[],this.__okHandlers=[],this.__cancelHandlers=[],this.__updateRequired=!0;let n=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.resetButton`,{"data-tchmi-width":135,"data-tchmi-height":30,"data-tchmi-text":"Load initial configuration","data-tchmi-tooltip":"Remove locally configured overrides and restore initial settings","data-tchmi-is-enabled":!1},this.__parentControl),s=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.okButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"OK","data-tchmi-tooltip":"Save and apply changes and close the popup"},this.__parentControl),r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.cancelButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Cancel","data-tchmi-tooltip":"Discard changes and close the popup"},this.__parentControl);if(!n||!s||!r)throw new Error("Could not create controls for SettingsPopup.");this.__elementFooter.appendChild(n.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(n.getId()+".onPressed",()=>{this.__onButtonPressed(this.__resetHandlers,!1)})),this.__elementFooter.appendChild(s.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(s.getId()+".onPressed",()=>{this.__onButtonPressed(this.__okHandlers,!0)})),this.__elementFooter.appendChild(r.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(r.getId()+".onPressed",()=>{this.__onButtonPressed(this.__cancelHandlers,!0)})),this.__resetButton=n}__onButtonPressed(e,t){this.__updateRequired=!0;for(let i=0,o=e.length;i<o;i++)!1===e[i]()&&(t=!1);t&&this.hide()}registerResetButtonHandler(e){return this.__resetHandlers.push(e),()=>{let t=this.__resetHandlers.indexOf(e);-1!==t&&this.__resetHandlers.splice(t,1)}}registerOkButtonHandler(e){return this.__okHandlers.push(e),()=>{let t=this.__okHandlers.indexOf(e);-1!==t&&this.__okHandlers.splice(t,1)}}registerCancelButtonHandler(e){return this.__cancelHandlers.push(e),()=>{let t=this.__cancelHandlers.indexOf(e);-1!==t&&this.__cancelHandlers.splice(t,1)}}update(e,t=!1){this.__settings=tchmi_clone_object(e),this.__updateRequired=!1,this.__resetButton.setIsEnabled(t)}getSettings(){return this.__settings}requiresUpdate(){return this.__updateRequired}}t.SettingsPopup=i}(i=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(i=t.Beckhoff||(t.Beckhoff={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let i;!function(t){let i;!function(t){class i extends t.SettingsPopup{constructor(t,i){super(t,"columnsPopup",i),this.__settings=[],this.__availableColumns=new e.List,this.__selectedColumns=new e.List,this.__columns={type:{label:"Type",order:0,allowSortable:!0},severity:{label:"Severity",order:1,allowSortable:!0},alarmState:{label:"Alarm state",order:2,allowSortable:!0},domain:{label:"Domain",order:3,allowSortable:!0},sourceDomain:{label:"Source Domain",order:4,allowSortable:!0},name:{label:"Name",order:5,allowSortable:!0},text:{label:"Text",order:6,allowSortable:!1},timeAndDateRaised:{label:"Time and date raised",order:7,allowSortable:!0},timeRaised:{label:"Time raised",order:8,allowSortable:!0},dateRaised:{label:"Date raised",order:9,allowSortable:!0},timeAndDateConfirmed:{label:"Time and date confirmed",order:10,allowSortable:!0},timeConfirmed:{label:"Time confirmed",order:11,allowSortable:!0},dateConfirmed:{label:"Date confirmed",order:12,allowSortable:!0},timeAndDateCleared:{label:"Time and date cleared",order:13,allowSortable:!0},timeCleared:{label:"Time cleared",order:14,allowSortable:!0},dateCleared:{label:"Date cleared",order:15,allowSortable:!0},"params::":{label:"params::",order:16,allowSortable:!0}},this.__activeElement=null,this.__activeColumn=null,this.__onAvailableColumnClick=e=>{let t=e.target;if(t.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||t.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){let e=t.parentElement,i=this.__availableColumns.findIndex(t=>t.element===e);if(-1===i)return;this.__availableColumns[i].name.startsWith("params::")?(this.__settings.push({columnName:"params::"}),e=this.__createColumnDiv("params::"),this.__elementSelectedColumns.appendChild(e),this.__selectedColumns.push({name:"params::",element:e})):(this.__settings.push({columnName:this.__availableColumns[i].name}),this.__elementSelectedColumns.appendChild(this.__availableColumns[i].element),this.__selectedColumns.push(this.__availableColumns[i]),this.__availableColumns.splice(i,1)),this.__activateColumn(e)}},this.__onSelectedColumnClick=e=>{let t=e.target;if(t.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column")||t.classList.contains("tchmi-event-grid-template-columns-config-column"))this.__activateColumn(t);else if(t.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||t.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){let e=t.parentElement,i=this.__selectedColumns.findIndex(t=>t.element===e);if(-1===i)return;this.__settings.splice(i,1);let o=this.__selectedColumns[i];if(this.__selectedColumns.splice(i,1),o.name.startsWith("params::"))this.__elementSelectedColumns.removeChild(o.element);else{this.__availableColumns.push(o),this.__availableColumns.sort((e,t)=>this.__columns[e.name].order-this.__columns[t.name].order);let e=this.__availableColumns.indexOf(o);-1===e||e>=this.__elementAvailableColumns.children.length?this.__elementAvailableColumns.appendChild(o.element):this.__elementAvailableColumns.insertBefore(o.element,this.__elementAvailableColumns.children[e])}this.__activateColumn(null)}},this.__onUpPressed=()=>{let e=this.__selectedColumns.findIndex(e=>e.element===this.__activeElement);if(-1===e||0===e)return;let t=this.__settings[e];this.__settings[e]=this.__settings[e-1],this.__settings[e-1]=t;let i=this.__selectedColumns[e];this.__selectedColumns[e]=this.__selectedColumns[e-1],this.__selectedColumns[e-1]=i,this.__activeElement&&this.__activeElement.previousElementSibling&&this.__activeElement.previousElementSibling.insertAdjacentElement("beforebegin",this.__activeElement),this.__updateButtons()},this.__onDownPressed=()=>{let e=this.__selectedColumns.findIndex(e=>e.element===this.__activeElement);if(-1===e||e===this.__settings.length-1)return;let t=this.__settings[e];this.__settings[e]=this.__settings[e+1],this.__settings[e+1]=t;let i=this.__selectedColumns[e];this.__selectedColumns[e]=this.__selectedColumns[e+1],this.__selectedColumns[e+1]=i,this.__activeElement&&this.__activeElement.nextElementSibling&&this.__activeElement.nextElementSibling.insertAdjacentElement("afterend",this.__activeElement),this.__updateButtons()},this.__onWidthChanged=()=>{let text=this.__widthTextbox.getText();if(!text)return this.__widthTextbox.setBackgroundColor(null),void(this.__activeColumn&&void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width&&(delete this.__activeColumn.width,delete this.__activeColumn.widthUnit));let e=parseFloat(text);if(!isNaN(e)&&/^[+-]?\d*\.?\d+(?:[eE][+-]\d+)?$/.test(text)){if(this.__widthTextbox.setBackgroundColor(null),this.__activeColumn&&(this.__activeColumn.width=e,!this.__activeColumn.widthUnit)){let e=this.__widthUnitCombobox.getSelectedValue();e?this.__activeColumn.widthUnit=e:this.__widthUnitCombobox.setSelectedIndex(0)}}else this.__widthTextbox.setBackgroundColor({color:"rgba(255, 0, 0, 1)"})},this.__onWidthUnitChanged=()=>{if(!this.__activeColumn)return;let e=this.__widthUnitCombobox.getSelectedValue();e?void 0!==this.__activeColumn.width&&(this.__activeColumn.widthUnit=e):delete this.__activeColumn.widthUnit},this.__onNameChanged=()=>{if(!this.__activeColumn||!this.__activeElement||!this.__activeColumn.columnName.startsWith("params::"))return;let e="params::"+(this.__nameTextbox.getText()||"");this.__activeColumn.columnName=e,this.__activeColumn.label||(this.__activeElement.firstChild.nodeValue=e)},this.__onLabelChanged=()=>{if(!this.__activeColumn||!this.__activeElement||!this.__activeColumn.columnName.startsWith("params::"))return;let e=this.__labelTextbox.getText();e?this.__activeColumn.label=e:delete this.__activeColumn.label,this.__activeColumn.label?this.__activeElement.firstChild.nodeValue=this.__activeColumn.label:this.__activeColumn.columnName?this.__activeElement.firstChild.nodeValue=this.__activeColumn.columnName:this.__activeElement.firstChild.nodeValue="params::"},this.__onSortableChanged=()=>{if(!this.__activeColumn)return;let e=this.__sortableCheckbox.getToggleState();e&&"Active"!==e?this.__activeColumn.sortable=!1:delete this.__activeColumn.sortable},this.__elementAvailableColumns=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-available-columns")[0],this.__elementSelectedColumns=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-selected-columns")[0];let o=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-order-buttons")[0],n=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-width")[0];this.__elementColumnName=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-name")[0],this.__elementColumnLabel=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-label")[0];let s=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-sortable")[0];if(!(this.__elementAvailableColumns&&this.__elementSelectedColumns&&o&&n&&this.__elementColumnName&&this.__elementColumnLabel&&s))throw new Error("Invalid Template.html");for(let e in this.__columns)this.__columns.hasOwnProperty(e)&&this.__availableColumns.push({name:e,element:this.__createColumnDiv(this.__columns[e].label)});this.__availableColumns.sort((e,t)=>this.__columns[e.name].order-this.__columns[t.name].order);let r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.upButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Move the selected column up"},this.__parentControl),l=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.downButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Move the selected column down"},this.__parentControl),a=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.widthTextbox`,{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-text-horizontal-alignment":"Right","data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),_=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__parentControl.getId()}.${this.__name}.widthUnitCombobox`,{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-src-data":[{text:"px",value:"px"},{text:"%",value:"%"}],"data-tchmi-content-padding":{left:4,right:4},"data-tchmi-is-enabled":!1},this.__parentControl),h=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.nameTextbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:44,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),d=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.labelTextbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),m=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",`${this.__parentControl.getId()}.${this.__name}.sortableCheckbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-is-enabled":!1},this.__parentControl);if(!(r&&l&&a&&_&&h&&d&&m))throw new Error("Could not create controls for ColumnsPopup.");this.__upButton=r,this.__downButton=l,this.__widthTextbox=a,this.__widthUnitCombobox=_,this.__nameTextbox=h,this.__labelTextbox=d,this.__sortableCheckbox=m;let c=r.getElement()[0];c.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-up-button"),c.classList.add("tchmi-event-grid-template-move-up-button"),o.appendChild(c),this.__eventDestroyers.push(e.EventProvider.register(r.getId()+".onPressed",this.__onUpPressed));let u=l.getElement()[0];u.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-down-button"),u.classList.add("tchmi-event-grid-template-move-down-button"),o.appendChild(u),this.__eventDestroyers.push(e.EventProvider.register(l.getId()+".onPressed",this.__onDownPressed)),n.appendChild(a.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(a.getId()+".onTextChanged",this.__onWidthChanged)),n.appendChild(_.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(_.getId()+".onSelectionChanged",this.__onWidthUnitChanged)),this.__elementColumnName.appendChild(h.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(h.getId()+".onTextChanged",this.__onNameChanged)),this.__elementColumnLabel.appendChild(d.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(d.getId()+".onTextChanged",this.__onLabelChanged)),s.appendChild(m.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(m.getId()+".onToggleStateChanged",this.__onSortableChanged)),this.__elementAvailableColumns.addEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.addEventListener("click",this.__onSelectedColumnClick)}destroy(){super.destroy(),this.__elementAvailableColumns.removeEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.removeEventListener("click",this.__onSelectedColumnClick)}update(e,t){super.update(e,t);for(let t=0,i=this.__availableColumns.length;t<i;t++)this.__availableColumns[t].name.startsWith("params::")||-1===e.findIndex(e=>e.columnName===this.__availableColumns[t].name)||(this.__selectedColumns.push(this.__availableColumns[t]),this.__availableColumns.splice(t,1),t--,i--);for(let t=0,i=this.__selectedColumns.length;t<i;t++)this.__selectedColumns[t].name.startsWith("params::")?(this.__selectedColumns.splice(t,1),t--,i--):-1===e.findIndex(e=>e.columnName===this.__selectedColumns[t].name)&&(this.__availableColumns.push(this.__selectedColumns[t]),this.__selectedColumns.splice(t,1),t--,i--);e.filter(e=>e.columnName.startsWith("params::")).forEach(e=>this.__selectedColumns.push({name:e.columnName,element:this.__createColumnDiv(e.label||e.columnName||"params::")})),this.__availableColumns.sort((e,t)=>this.__columns[e.name].order-this.__columns[t.name].order),this.__selectedColumns.sort((t,i)=>e.findIndex(e=>e.columnName===t.name)-e.findIndex(e=>e.columnName===i.name));let i=document.createDocumentFragment();for(let e=0,t=this.__availableColumns.length;e<t;e++)i.appendChild(this.__availableColumns[e].element);this.__elementAvailableColumns.textContent="",this.__elementAvailableColumns.appendChild(i);let o=document.createDocumentFragment();for(let e=0,t=this.__selectedColumns.length;e<t;e++)o.appendChild(this.__selectedColumns[e].element);this.__elementSelectedColumns.textContent="",this.__elementSelectedColumns.appendChild(o),this.__activateColumn(null)}__activateColumn(e){if(this.__activeElement&&this.__activeElement.classList.remove("active"),e){this.__activeElement=e,e.classList.add("active");let t=this.__selectedColumns.findIndex(t=>t.element===e);this.__activeColumn=this.__settings[t]||null}else this.__activeElement=null,this.__activeColumn=null;this.__updateButtons(),this.__updateColumnProperties()}__updateButtons(){this.__upButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.firstElementChild),this.__downButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.lastElementChild)}__updateColumnProperties(){var e;let t=()=>{this.__nameTextbox.setIsEnabled(!1),this.__labelTextbox.setIsEnabled(!1),this.__elementColumnName.classList.add("hidden"),this.__elementColumnLabel.classList.add("hidden")};if(this.__activeColumn){if(this.__widthTextbox.setIsEnabled(!0),this.__widthUnitCombobox.setIsEnabled(!0),void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width?this.__widthTextbox.setText(this.__activeColumn.width.toString(10)):this.__widthTextbox.setText(null),this.__activeColumn.widthUnit){let e=-1,t=this.__widthUnitCombobox.getSrcData();Array.isArray(t)&&(e=t.findIndex(e=>e.value===this.__activeColumn.widthUnit)),this.__widthUnitCombobox.setSelectedIndex(-1!==e?e:null)}else this.__widthUnitCombobox.setSelectedIndex(null);(null===(e=this.__columns[this.__activeColumn.columnName])||void 0===e?void 0:e.allowSortable)?(this.__sortableCheckbox.setIsEnabled(!0),void 0===this.__activeColumn.sortable?this.__sortableCheckbox.setToggleState("Active"):this.__sortableCheckbox.setToggleState(this.__activeColumn.sortable?"Active":"Normal")):(this.__sortableCheckbox.setIsEnabled(!1),this.__sortableCheckbox.setToggleState("Normal")),this.__activeColumn.columnName.startsWith("params::")?(this.__nameTextbox.setIsEnabled(!0),this.__labelTextbox.setIsEnabled(!0),this.__nameTextbox.setText(this.__activeColumn.columnName.slice("params::".length)),this.__labelTextbox.setText(this.__activeColumn.label||null),this.__elementColumnName.classList.remove("hidden"),this.__elementColumnLabel.classList.remove("hidden")):t()}else this.__widthTextbox.setIsEnabled(!1),this.__widthUnitCombobox.setIsEnabled(!1),this.__sortableCheckbox.setIsEnabled(!1),this.__widthTextbox.setText(null),this.__widthUnitCombobox.setSelectedIndex(null),this.__sortableCheckbox.setToggleState("Normal"),t()}__createColumnDiv(e){let t=document.createElement("div");t.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column"),t.classList.add("tchmi-event-grid-template-columns-config-column"),t.textContent=e;let i=document.createElement("div");return i.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle"),i.classList.add("tchmi-event-grid-template-columns-config-column-selection-toggle"),t.appendChild(i),t}}t.ColumnsPopup=i}(i=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(i=t.Beckhoff||(t.Beckhoff={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let i;!function(t){let i;!function(i){class o extends i.SettingsPopup{constructor(t,i){super(t,"filterPopup",i),this.__settings=[],this.__localizableEnums=[],this.__domainPaths=new Map,this.__rows=[],this.__selectedRows=[],this.__groupInfo=null,this.__ungroupInfo=null,this.__onScroll=e=>{this.__elementFilterTableHeader.scrollLeft=this.__elementFilterTable.scrollLeft},this.__onLocaleChangedDestroyer=null,this.__onLocaleChanged=()=>{this.__localizeEnumLabels()},this.__localizeRequestId=null,this.__listDomainsSubscriptionId=null;let o=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table-header")[0];o&&(this.__elementFilterTableHeader=o);let n=this.__elementContent.querySelector("th.TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column");n&&(this.__elementIndentationHeader=n);let s=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table")[0];s&&(this.__elementFilterTable=s);let r=this.__elementContent.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table tbody");r&&(this.__elementFilterTableBody=r);let l=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-menubar")[0];if(!(o&&n&&s&&r&&l))throw new Error("Invalid Template.html");s.addEventListener("scroll",this.__onScroll);let a=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.addButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Add a filter clause"},this.__parentControl),_=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.removeButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Remove selected filter clauses"},this.__parentControl),h=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.groupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Group selected filter clauses"},this.__parentControl),d=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.ungroupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"Ungroup selected filter clauses"},this.__parentControl);if(!(a&&_&&h&&d))throw new Error("Could not create controls for FilterPopup.");_.setIsEnabled(!1),h.setIsEnabled(!1),d.setIsEnabled(!1);let m=a.getElement()[0];m.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-add-button"),m.classList.add("tchmi-event-grid-template-add-button"),l.appendChild(m);let c=_.getElement()[0];c.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-remove-button"),c.classList.add("tchmi-event-grid-template-remove-button"),l.appendChild(c);let u=h.getElement()[0];u.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-group-button"),u.classList.add("tchmi-event-grid-template-group-button"),l.appendChild(u);let p=d.getElement()[0];p.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-ungroup-button"),p.classList.add("tchmi-event-grid-template-ungroup-button"),l.appendChild(p),this.__eventDestroyers.push(e.EventProvider.register(a.getId()+".onPressed",()=>{this.__add()})),this.__eventDestroyers.push(e.EventProvider.register(_.getId()+".onPressed",()=>{this.__remove()})),this.__eventDestroyers.push(e.EventProvider.register(h.getId()+".onPressed",()=>{this.__group()})),this.__eventDestroyers.push(e.EventProvider.register(d.getId()+".onPressed",()=>{this.__ungroupInfo&&this.__ungroup(this.__ungroupInfo,this.__selectedRows)})),this.__removeButton=_,this.__groupButton=h,this.__ungroupButton=d;let g=this.__parseSchema(e.Type.getSchema("tchmi:server#/definitions/eventFilter"));this.__schemaInfo=g.schemaInfo,this.__localizableEnums=g.localizationInfo;for(const path of g.domainPaths){let e=this.__schemaInfo.availablePaths.get(path);e&&this.__domainPaths.set(path,e)}this.__localizeEnumLabels(),this.__subscribeListDomains(),this.__onLocaleChangedDestroyer=e.EventProvider.register("onLocaleChanged",this.__onLocaleChanged)}update(t,i){super.update(t,i),this.__selectedRows=[];let o=document.createDocumentFragment(),n=[],s=0,r={filter:this.__settings,parent:null},l=(t,i,a=0)=>{for(let _=0,h=t.length;_<h;_++){let d=t[_];if(e.isLogicOperator(d))i=d;else if(Array.isArray(d)){n.push("first"),s=Math.max(s,n.length),r={filter:d,parent:r},_===h-1?l(d,i,a+1):l(d,i),r.parent&&(r=r.parent)}else if(e.isComparison(d)){if(_===h-1)for(let e=0;e<=a;e++)n[n.length-(e+1)]="last";if(o.appendChild(this.__createRow(n,r,d,i)),_===h-1)n=n.slice(0,-(a+1));else for(let e=0,t=n.length;e<t;e++)n[e]="middle"}}};l(this.__settings),this.__elementFilterTableBody.innerHTML="",this.__elementFilterTableBody.appendChild(o),this.__elementIndentationHeader.style.minWidth=s?6*s+5+"px":"1px",this.__processSelection()}show(){super.show(),this.__subscribeListDomains()}hide(){super.hide(),this.__updateRequired&&this.__clear(),null!==this.__listDomainsSubscriptionId&&(e.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null)}destroy(){super.destroy(),this.__elementFilterTable.removeEventListener("scroll",this.__onScroll),this.__onLocaleChangedDestroyer&&(this.__onLocaleChangedDestroyer(),this.__onLocaleChangedDestroyer=null),null!==this.__localizeRequestId&&(e.Server.releaseRequest(this.__localizeRequestId),this.__localizeRequestId=null),null!==this.__listDomainsSubscriptionId&&(e.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null),this.__clear()}__clear(){this.__elementFilterTableBody.innerHTML="";for(let e=0,t=this.__rows.length;e<t;e++){let t=this.__rows[e];t.selection.destroyer(),t.selection.control.destroy(),t.logic&&(t.logic.destroyer(),t.logic.control.destroy()),t.path.destroyer&&t.path.destroyer(),t.path.control&&t.path.control.destroy(),t.comparator.destroyer&&t.comparator.destroyer(),t.comparator.control&&t.comparator.control.destroy(),t.value.destroyer&&t.value.destroyer(),t.value.control&&t.value.control.destroy(),t.value.dateTimePickerEventDestroyer&&t.value.dateTimePickerEventDestroyer(),t.value.dateTimePicker&&t.value.dateTimePicker.destroy(),t.value.dateTimeButtonEventDestroyer&&t.value.dateTimeButtonEventDestroyer(),t.value.dateTimeButton&&t.value.dateTimeButton.destroy()}this.__rows=[]}__createRow(t,i,o,n){let s=document.createElement("tr"),r=document.createElement("td");r.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-selection-column"),r.classList.add("tchmi-event-grid-template-filter-selection-column");let l=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__newControlId(),null,this.__parentControl);if(!l)throw new Error("Could not create controls for FilterPopup.");let a=this.__cloneNesting(i),_=e.EventProvider.register(l.getId()+".onStateChanged",(e,t)=>{let i={rowElement:s,comparison:o,parent:a};t.state?this.__selectRow(i):this.__deselectRow(i)});r.appendChild(l.getElement()[0]);let h=document.createElement("td");h.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column"),h.classList.add("tchmi-event-grid-template-filter-indentation-column");for(let e=0,i=t.length;e<i;e++){let i=document.createElement("div");i.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),i.classList.add("tchmi-event-grid-template-filter-indentation-marker"),i.classList.add(t[e]),h.appendChild(i)}let d=document.createElement("td");d.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-logic-column"),d.classList.add("tchmi-event-grid-template-filter-logic-column");let m=document.createElement("td");m.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-path-column"),m.classList.add("tchmi-event-grid-template-filter-path-column");let c=document.createElement("td");c.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-comparator-column"),c.classList.add("tchmi-event-grid-template-filter-comparator-column");let u=document.createElement("td");u.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-value-column"),u.classList.add("tchmi-event-grid-template-filter-value-column");let p={row:s,comparison:o,parent:a,selection:{control:l,destroyer:_},path:{control:null,destroyer:null},comparator:{cell:c,control:null,destroyer:null},value:{cell:u,control:null,destroyer:null,dateTimePicker:null,dateTimePickerEventDestroyer:null,dateTimeButton:null,dateTimeButtonEventDestroyer:null}};if(n){p.logicOperator=n;let t=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":this.__schemaInfo.availableLogic,"data-tchmi-selected-index":this.__schemaInfo.availableLogic.indexOf(n.logic),"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!t)throw new Error("Could not create controls for FilterPopup.");p.logic={control:t,destroyer:e.EventProvider.register(t.getId()+".onSelectionChanged",(e,t)=>{n.logic=t.value})},d.appendChild(t.getElement()[0])}let g=Array.from(this.__schemaInfo.availablePaths.keys());if(g.length>0){let t=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":g,"data-tchmi-allow-text-input":null!==this.__schemaInfo.freePath,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":500},this.__parentControl);if(!t)throw new Error("Could not create controls for FilterPopup.");p.path.control=t;let i=g.indexOf(o.path||"");-1!==g.indexOf(o.path||"")?t.setSelectedIndex(i):t.setText(o.path),p.path.destroyer=e.EventProvider.register(t.getId()+".onUserInteractionFinished",()=>{let path=t.getText();o.path!==path&&(null==path||""===path?delete o.path:o.path=path.toString(),o.value="",this.__updateControls(p))}),m.appendChild(t.getElement()[0])}else{let t=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!t)throw new Error("Could not create controls for FilterPopup.");p.path.control=t,p.path.destroyer=e.EventProvider.register(t.getId()+".onUserInteractionFinished",()=>{let path=t.getText();null==path||""===path?delete o.path:o.path=path}),m.appendChild(t.getElement()[0])}return this.__updateControls(p),s.appendChild(r),s.appendChild(h),s.appendChild(d),s.appendChild(m),s.appendChild(c),s.appendChild(u),this.__rows.push(p),s}__updateControls(i){var o,n,s;let r=this.__getPathInfo(i.comparison.path);if(i.path.control instanceof t.TcHmiCombobox&&((null==r?void 0:r.isSuggestion)?(i.path.control.setAllowTextInput(!0),null===(o=i.path.control.getElement()[0].getElementsByTagName("input")[0])||void 0===o||o.focus()):i.path.control.setAllowTextInput(!1)),!i.comparator.control){if(i.comparator.control=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl)||null,!i.comparator.control)throw new Error("Could not create controls for FilterPopup.");i.comparator.destroyer=e.EventProvider.register(i.comparator.control.getId()+".onUserInteractionFinished",()=>{let e=i.comparator.control.getText();"string"==typeof e&&""!==e&&(i.comparison.comparator=e)}),i.comparator.cell.appendChild(i.comparator.control.getElement()[0])}let l=i.comparator.control;r?(l.setAllowTextInput(!1),l.setSrcData(r.comparators),l.setSelectedIndex(r.comparators.indexOf(i.comparison.comparator))):l.setAllowTextInput(!0);let a="TcHmi.Controls.Beckhoff.TcHmiTextbox";r&&r.values.length>0&&(a="TcHmi.Controls.Beckhoff.TcHmiCombobox"),i.value.control&&i.value.control.getType()!==a&&(i.value.destroyer&&(i.value.destroyer(),i.value.destroyer=null),i.value.cell.removeChild(i.value.control.getElement()[0]),i.value.control.destroy(),i.value.control=null);let _=!1;if(!i.value.control){if(i.value.control=e.ControlFactory.createEx(a,this.__newControlId(),"TcHmi.Controls.Beckhoff.TcHmiCombobox"===a?{"data-tchmi-max-list-height":250}:{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl)||null,!i.value.control)throw new Error("Could not create controls for FilterPopup.");_=!0,i.value.cell.appendChild(i.value.control.getElement()[0])}switch(a){case"TcHmi.Controls.Beckhoff.TcHmiTextbox":let text,t=i.value.control;text=i.comparison.value instanceof Date?i.comparison.value.toISOString():null===i.comparison.value?"null":i.comparison.value.toString(),t.setText(text),_&&(i.value.destroyer=e.EventProvider.register(t.getId()+".onUserInteractionFinished",()=>{let o=t.getText();if(null==o)return;let n=this.__getPathInfo(i.comparison.path);if((null==n?void 0:n.nullable)&&"null"===o.toLowerCase())i.comparison.value=null;else{switch(n?n.valueType:"any"){case"string":i.comparison.value=e.ValueConverter.toString(o,"");break;case"number":case"integer":i.comparison.value=e.ValueConverter.toNumber(o,0);break;case"boolean":i.comparison.value=e.ValueConverter.toBoolean(o,!1);break;default:i.comparison.value=o}}i.value.dateTimePicker&&i.value.dateTimePicker.setValue(o)}));break;case"TcHmi.Controls.Beckhoff.TcHmiCombobox":let o=i.value.control;if(!r)break;let l=[];for(let e=0,t=r.values.length;e<t;e++){let t=r.values[e];l.push({value:t,text:null!==(s=null!==(n=r.localizedLabels.get(t))&&void 0!==n?n:r.labels.get(t))&&void 0!==s?s:t})}if(o.setSrcData(l),o.setAllowTextInput(r.allowFreeValue),o.setSelectedIndex(r.values.indexOf(i.comparison.value)),r.allowFreeValue&&-1===r.values.indexOf(i.comparison.value)){let text;text=i.comparison.value instanceof Date?i.comparison.value.toISOString():null===i.comparison.value?"null":i.comparison.value.toString(),o.setText(text)}_&&(i.value.destroyer=e.EventProvider.register(o.getId()+".onUserInteractionFinished",()=>{let t=o.getSelectedValue(),n=this.__getPathInfo(i.comparison.path);if(null==t&&n.allowFreeValue&&(t=o.getText),null!=t)if((null==n?void 0:n.nullable)&&"null"===t.toLowerCase())i.comparison.value=null;else{switch(n?n.valueType:"any"){case"string":i.comparison.value=e.ValueConverter.toString(t,"");break;case"number":case"integer":i.comparison.value=e.ValueConverter.toNumber(t,0);break;case"boolean":i.comparison.value=e.ValueConverter.toBoolean(t,!1);break;default:i.comparison.value=t}}}))}if(r&&r.valueIsDate){if(!i.value.dateTimePicker){if(i.value.dateTimePicker=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDateTimePicker",this.__newControlId(),{"data-tchmi-visibility":"Collapsed"},this.__parentControl)||null,!i.value.dateTimePicker)throw new Error("Could not create controls for FilterPopup.");i.value.dateTimePickerEventDestroyer=e.EventProvider.register(i.value.dateTimePicker.getId()+".onValueChanged",()=>{let e=i.value.dateTimePicker.getValue();if(!e)return;i.value.control&&i.value.control.setText(e);let t=this.__getPathInfo(i.comparison.path);(null==t?void 0:t.nullable)&&"null"===e.toLowerCase()?i.comparison.value=null:i.comparison.value=e}),i.value.cell.appendChild(i.value.dateTimePicker.getElement()[0])}if(i.value.dateTimePicker.setValue("string"==typeof i.comparison.value?i.comparison.value:null),!i.value.dateTimeButton){if(i.value.dateTimeButton=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__newControlId(),{"data-tchmi-width":26,"data-tchmi-height":30},this.__parentControl)||null,!i.value.dateTimeButton)throw new Error("Could not create controls for FilterPopup.");i.value.dateTimeButtonEventDestroyer=e.EventProvider.register(i.value.dateTimeButton.getId()+".onPressed",()=>{i.value.dateTimePicker&&i.value.dateTimePicker.openDateTimePicker()});let t=i.value.dateTimeButton.getElement()[0];t.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-date-time-button"),t.classList.add("tchmi-event-grid-template-date-time-button"),i.value.cell.appendChild(t)}}else i.value.dateTimePickerEventDestroyer&&(i.value.dateTimePickerEventDestroyer(),i.value.dateTimePickerEventDestroyer=null),i.value.dateTimePicker&&(i.value.cell.removeChild(i.value.dateTimePicker.getElement()[0]),i.value.dateTimePicker.destroy(),i.value.dateTimePicker=null),i.value.dateTimeButtonEventDestroyer&&(i.value.dateTimeButtonEventDestroyer(),i.value.dateTimeButtonEventDestroyer=null),i.value.dateTimeButton&&(i.value.cell.removeChild(i.value.dateTimeButton.getElement()[0]),i.value.dateTimeButton.destroy(),i.value.dateTimeButton=null)}__getPathInfo(path=""){let e=this.__schemaInfo.availablePaths.get(path);if(!e)for(const[t,i]of this.__schemaInfo.availablePaths)if(i.isSuggestion&&path.startsWith(t)){e=i;break}return!e&&this.__schemaInfo.freePath&&(e=this.__schemaInfo.freePath),null!=e?e:null}__selectRow(e){this.__selectedRows.push(e),this.__processSelection()}__deselectRow(e){for(let t=0,i=this.__selectedRows.length;t<i;t++)if(this.__selectedRows[t].comparison===e.comparison){this.__selectedRows.splice(t,1);break}this.__processSelection()}__add(){let[path,e]=this.__schemaInfo.freePath?["",this.__schemaInfo.freePath]:this.__schemaInfo.availablePaths.entries().next().value,t={logic:this.__schemaInfo.availableLogic[0]},i={path:path,comparator:e.comparators[0],value:e.allowFreeValue?"":e.values[0]};if(this.__selectedRows.length>0){this.__selectedRows.sort((e,t)=>t.rowElement.rowIndex-e.rowElement.rowIndex);let e=this.__selectedRows[0];e.parent.filter.splice(e.parent.filter.indexOf(e.comparison)+1,0,t,i);let o=[],n=e.rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker");for(let e=0,t=n.length;e<t;e++)"last"===n[e].classList[1]?(n[e].classList.remove("last"),n[e].classList.add("middle"),o.push("last")):o.push("middle");e.rowElement.insertAdjacentElement("afterend",this.__createRow(o,e.parent,i,t))}else this.__elementFilterTableBody.appendChild(this.__createRow([],{filter:this.__settings,parent:null},i,this.__settings.length>0?t:void 0)),this.__settings.length>0&&this.__settings.push(t),this.__settings.push(i);this.__processSelection()}__remove(){for(let e=0,t=this.__selectedRows.length;e<t;e++){let t=this.__selectedRows[e],i=t.parent.filter.indexOf(t.comparison);if(-1===i)continue;let o=t.rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),n=null;for(let e=0,i=o.length;e<i;e++)if("first"===o[e].classList[1]){if(!n){let e=t.rowElement.nextElementSibling;if(!e)break;n=e.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker")}n[e].classList.remove("middle"),n[e].classList.add("first")}else if("last"===o[e].classList[1]){if(!n){let e=t.rowElement.previousElementSibling;if(!e)break;n=e.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker")}n[e].classList.remove("middle"),n[e].classList.add("last")}let s=-1;for(let e=0,i=this.__rows.length;e<i;e++)if(this.__rows[e].row===t.rowElement){s=e;break}if(-1!==s){let e=this.__rows[s];e.selection.destroyer(),e.selection.control.destroy(),e.logic&&(e.logic.destroyer(),e.logic.control.destroy()),e.path.destroyer&&e.path.destroyer(),e.path.control&&e.path.control.destroy(),e.comparator.destroyer&&e.comparator.destroyer(),e.comparator.control&&e.comparator.control.destroy(),e.value.destroyer&&e.value.destroyer(),e.value.control&&e.value.control.destroy(),e.value.dateTimePickerEventDestroyer&&e.value.dateTimePickerEventDestroyer(),e.value.dateTimePicker&&e.value.dateTimePicker.destroy(),e.value.dateTimeButtonEventDestroyer&&e.value.dateTimeButtonEventDestroyer(),e.value.dateTimeButton&&e.value.dateTimeButton.destroy(),this.__rows.splice(s,1)}if(this.__elementFilterTableBody.removeChild(t.rowElement),t.parent.filter.splice(i,1),i>0)t.parent.filter.splice(i-1,1);else{let e=t.parent,i=0;for(;e.parent;){if(i=e.parent.filter.indexOf(e.filter),-1===i)throw new Error("Filter in invalid state. Parent filter does not contain child filter.");if(0!==i)break;e=e.parent}if(0===i){t.parent.filter.length>0&&t.parent.filter.splice(0,1);let e=this.__elementFilterTableBody.firstElementChild;if(e){for(let e=0,i=this.__rows.length;e<i;e++)if(this.__rows[e].row===t.rowElement){this.__rows[e].logic&&(this.__rows[e].logic.destroyer(),this.__rows[e].logic.control.destroy(),delete this.__rows[e].logic);break}let i=e.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-logic-column .TcHmi_Controls_Beckhoff_TcHmiCombobox");i&&i.parentElement.removeChild(i)}}else e.filter.splice(i-1,1,t.parent.filter.splice(0,1)[0])}if(1===t.parent.filter.length&&t.parent.parent){let e=[];for(let i=0,o=this.__rows.length;i<o;i++){let o=this.__rows[i].parent;for(;o&&o.filter!==t.parent.filter;)o=o.parent;o&&e.push({rowElement:this.__rows[i].row,comparison:this.__rows[i].comparison,parent:this.__rows[i].parent})}e.length>0&&this.__ungroup({parent:t.parent.parent,toUngroup:t.parent},e)}}this.__selectedRows=[],this.__processSelection()}__group(){if(!this.__groupInfo)return;let e=this.__groupInfo.parent.filter.length,t=-1;for(let i=0,o=this.__groupInfo.toGroup.length;i<o;i++){let o=this.__groupInfo.parent.filter.indexOf(this.__groupInfo.toGroup[i]);if(-1===o)return;e=o<e?o:e,t=o>t?o:t}let i=this.__groupInfo.parent.filter.splice(e,t-e+1);this.__groupInfo.parent.filter.splice(e,0,i),this.__selectedRows.sort((e,t)=>e.rowElement.rowIndex-t.rowElement.rowIndex);let o={filter:this.__groupInfo.parent.filter,parent:this.__groupInfo.parent.parent},n=this.__groupInfo.parent.filter;for(let e=0,t=this.__selectedRows.length;e<t;e++){let s=this.__selectedRows[e].parent,r=0;for(;s.parent&&s.filter!==n;)s=s.parent,r++;s.filter=i,s.parent=this.__cloneNesting(o);let l=this.__selectedRows[e].rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column")[0];if(l){let i=document.createElement("div");i.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),i.classList.add("tchmi-event-grid-template-filter-indentation-marker"),0===e?i.classList.add("first"):e+1===t?i.classList.add("last"):i.classList.add("middle"),l.insertBefore(i,l.childNodes[l.childElementCount-r]||null)}}this.__processSelection(),this.__resizeIndentationHeader()}__ungroup(e,t){let i=e.parent.filter.indexOf(e.toUngroup.filter);if(-1!==i){e.parent.filter.splice(i,1,...e.toUngroup.filter),t.sort((e,t)=>e.rowElement.rowIndex-t.rowElement.rowIndex);for(let i=0,o=t.length;i<o;i++){let n,s=t[i].parent;for(;s.parent&&s.parent.filter!==e.parent.filter;)s=s.parent;s.filter=e.parent.filter,s.parent=e.parent.parent?this.__cloneNesting(e.parent.parent):null,n=0===i?t[i].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.first"):i+1===o?t[i].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.last"):t[i].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.middle"),n&&n.parentElement.removeChild(n)}this.__processSelection(),this.__resizeIndentationHeader()}}__processSelection(){if(this.__removeButton.setIsEnabled(this.__selectedRows.length>0),this.__groupInfo=null,this.__ungroupInfo=null,this.__selectedRows.length<2)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let t=new e.List,i=[];for(let e=0,o=this.__selectedRows.length;e<o;e++){let n=this.__selectedRows[e];i[n.rowElement.rowIndex]=!0;let s=t.firstOrDefault(e=>e.nesting.filter===n.parent.filter);for(s||(s={nesting:n.parent,itemCount:Math.ceil(n.parent.filter.length/2),selectedItems:[]},t.push(s)),s.selectedItems.push(n.comparison);s.selectedItems.length>=s.itemCount&&(e+1<o||t.length>1);){if(!s.nesting.parent)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let e=t.firstOrDefault(e=>e.nesting.filter===s.nesting.parent.filter);e||(e={nesting:s.nesting.parent,itemCount:Math.ceil(s.nesting.parent.filter.length/2),selectedItems:[]},t.push(e)),e.selectedItems.push(s.nesting.filter),t.splice(t.indexOf(s),1),s=e}}if(1===t.length){let e=t[0],o=!0;for(let e=i.indexOf(!0),t=i.length;e<t;e++)if(!i[e]){o=!1;break}e.selectedItems.length<e.itemCount&&o?this.__groupInfo={parent:e.nesting,toGroup:e.selectedItems}:e.selectedItems.length===e.itemCount&&e.nesting.parent&&(this.__ungroupInfo={parent:e.nesting.parent,toUngroup:e.nesting})}this.__groupButton.setIsEnabled(null!==this.__groupInfo),this.__ungroupButton.setIsEnabled(null!==this.__ungroupInfo)}__resizeIndentationHeader(){let e=this.__elementFilterTableBody.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column")[0];this.__elementIndentationHeader.style.minWidth=(e?e.offsetWidth:0)+"px"}__newControlId(){return`${this.__parentControl.getId()}.${this.__name}.${tchmi_create_guid()}`}__cloneNesting(e){return{filter:e.filter,parent:e.parent?this.__cloneNesting(e.parent):null}}__parseSchema(e){var t,i;if(e&&"array"===e.type&&e.items){let o=null;if(Array.isArray(e.items)?o=e.items:"object"===e.items.type?o=[e.items]:e.items.anyOf?o=e.items.anyOf:e.items.oneOf&&(o=e.items.oneOf),o){let e={availablePaths:new Map,freePath:null,availableLogic:[]},n=[],s=[];for(let r=0,l=o.length;r<l;r++){let l=o[r];if("object"===l.type&&l.properties&&l.properties.logic&&l.properties.logic.enum){for(let t=0,i=l.properties.logic.enum.length;t<i;t++)-1===e.availableLogic.indexOf(l.properties.logic.enum[t])&&e.availableLogic.push(l.properties.logic.enum[t]);continue}if(!("object"===l.type&&l.properties&&l.properties.comparator&&l.properties.comparator.enum&&l.properties.value))continue;let a=null,_=!1;if(l.properties.path){if(l.properties.path.enum)a=l.properties.path.enum;else if(l.properties.path.pattern){let e=l.properties.path.pattern;if(e.startsWith("^")){let t=e.substring(1).replace(/\\(.)/g,"$1");new RegExp(e).test(t)&&(a=[t],_=!0)}}}else a=[""];let h=[];if(a)for(let t=0,i=a.length;t<i;t++)e.availablePaths.has(a[t])||e.availablePaths.set(a[t],{comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:_}),h.push(e.availablePaths.get(a[t]));else e.freePath||(e.freePath={comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1}),h.push(e.freePath);for(let e=0,o=h.length;e<o;e++){for(let t=0,i=l.properties.comparator.enum.length;t<i;t++)-1===h[e].comparators.indexOf(l.properties.comparator.enum[t])&&h[e].comparators.push(l.properties.comparator.enum[t]);let o=null!==(i=null!==(t=l.properties.value.oneOf)&&void 0!==t?t:l.properties.value.anyOf)&&void 0!==i?i:[l.properties.value],r=!1;o.forEach(t=>{if("string"===t.type||"number"===t.type||"integer"===t.type||"boolean"===t.type?r?h[e].valueType="any":(h[e].valueType=t.type,r=!0):"null"===t.type&&(h[e].nullable=!0),t.enum)for(let i=0,o=t.enum.length;i<o;i++)h[e].values.includes(t.enum[i])||h[e].values.push(t.enum[i]);else a&&a[e].toLowerCase().includes("domain")?(h[e].values=[""],h[e].allowFreeValue=!0,s.push(a[e])):h[e].allowFreeValue=!0;if(t.options){let i=t.options;for(let t=0,o=i.length;t<o;t++)h[e].labels.set(i[t].value,i[t].label);n.includes(h[e])||n.push(h[e])}"date-time"===t.format&&(h[e].valueIsDate=!0)})}}return{schemaInfo:e,localizationInfo:n,domainPaths:s}}}return{schemaInfo:{availablePaths:new Map,freePath:{comparators:["==","!=","<",">","<=",">=","contains","contains not","== [ignore case]","!= [ignore case]","contains [ignore case]","contains not [ignore case]"],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!0,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1},availableLogic:["AND","OR"]},localizationInfo:[],domainPaths:[]}}__localizeEnumLabels(){if(0===this.__localizableEnums.length)return;let i={requestType:"ReadWrite",commands:[]},o={};for(let e=0,t=this.__localizableEnums.length;e<t;e++)for(const[t,n]of this.__localizableEnums[e].labels)o[n]={pathInfo:this.__localizableEnums[e],key:t},i.commands.push({symbol:"LocalizeText",writeValue:{domain:"TcHmiSrv",name:n},commandOptions:["SendWriteValue","SendErrorMessage"]});this.__localizeRequestId=e.Server.requestEx(i,null,i=>{var n,s;if(this.__localizeRequestId=null,i.error===e.Errors.NONE)if(i.response)if(i.response.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] ${e.Log.buildMessage(i.response.error)}`);else if(i.response.commands&&0!==i.response.commands.length){for(let t=0,n=i.response.commands.length;t<n;t++){if(i.response.commands[t].error){TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] ${e.Log.buildMessage(i.response.commands[t].error)}`);continue}if(!i.response.commands[t].readValue){TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] `+e.Log.buildMessage({code:e.Errors.E_SERVER_READVALUE_MISSING,message:e.Errors[e.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${i.response.commands[t].symbol}' in response from server with id: '${i.response.id}'.`,domain:this.__parentControl.getType()}));continue}let n=i.response.commands[t].writeValue;"object"==typeof n&&n.name&&o[n.name]&&o[n.name].pathInfo.localizedLabels.set(o[n.name].key,i.response.commands[t].readValue)}for(let e=0,i=this.__rows.length;e<i;e++){let i=this.__rows[e].value.control;if(i instanceof t.TcHmiCombobox){let t=this.__getPathInfo(this.__rows[e].comparison.path);if(!t||0===t.localizedLabels.size)continue;let o=[];for(let e=0,i=t.values.length;e<i;e++){let i=t.values[e];o.push({value:i,text:null!==(s=null!==(n=t.localizedLabels.get(i))&&void 0!==n?n:t.labels.get(i))&&void 0!==s?s:i})}let r=i.getSelectedIndex();i.setSrcData(o),i.setSelectedIndex(void 0===r?null:r)}}}else TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] `+e.Log.buildMessage({code:e.Errors.E_SERVER_COMMANDS_MISSING,message:e.Errors[e.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${i.response.id}'.`,domain:this.__parentControl.getType()}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] `+e.Log.buildMessage({code:e.Errors.E_SERVER_RESPONSE_MISSING,message:e.Errors[e.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__parentControl.getType()}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] ${e.Log.buildMessage(i.details)}`)})}__subscribeListDomains(){0!==this.__domainPaths.size&&null===this.__listDomainsSubscriptionId&&(this.__listDomainsSubscriptionId=e.Server.subscribeEx([{symbol:"ListDomains"}],1e3,null,i=>{if(i.error!==e.Errors.NONE)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] ${e.Log.buildMessage(i.details)}`));if(!i.response)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] `+e.Log.buildMessage({code:e.Errors.E_SERVER_RESPONSE_MISSING,message:e.Errors[e.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__parentControl.getType()})));if(i.response.error)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] ${e.Log.buildMessage(i.response.error)}`));if(!i.response.commands||0===i.response.commands.length)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] `+e.Log.buildMessage({code:e.Errors.E_SERVER_COMMANDS_MISSING,message:e.Errors[e.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${i.response.id}'.`,domain:this.__parentControl.getType()})));if(i.response.commands[0].error)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] ${e.Log.buildMessage(i.response.commands[0].error)}`));if(!i.response.commands[0].readValue)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] `+e.Log.buildMessage({code:e.Errors.E_SERVER_READVALUE_MISSING,message:e.Errors[e.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${i.response.commands[0].symbol}' in response from server with id: '${i.response.id}'.`,domain:this.__parentControl.getType()})));let o=Object.keys(i.response.commands[0].readValue);for(const e of this.__domainPaths.values())e.values=o;this.__rows.filter(e=>e.comparison.path&&this.__domainPaths.has(e.comparison.path)).forEach(e=>{var i,o,n;let s=e.value.control;if(s instanceof t.TcHmiCombobox){let t=this.__getPathInfo(e.comparison.path);if(!t)return;let r=[];for(let e=0,n=t.values.length;e<n;e++){let n=t.values[e];r.push({value:n,text:null!==(o=null!==(i=t.localizedLabels.get(n))&&void 0!==i?i:t.labels.get(n))&&void 0!==o?o:n})}let l=null!==(n=s.getSelectedValue())&&void 0!==n?n:s.getText(),a=r.findIndex(e=>e.value===l);s.setSrcData(r),-1!==a?(s.getAllowTextInput()&&s.setText(null),s.setSelectedIndex(a)):(s.setSelectedIndex(null),s.getAllowTextInput()&&s.setText(l))}})}))}}i.FilterPopup=o}(i=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(i=t.Beckhoff||(t.Beckhoff={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let i;!function(t){let i;!function(t){class i extends t.Popup{constructor(t,i){super(t,"detailsPopup",i),this.__event=null;let o=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.confirmButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"Confirm this alarm"},this.__parentControl),n=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.closeButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Close","data-tchmi-tooltip":"Close popup"},this.__parentControl);if(!o||!n)throw new Error("Could not create controls for DetailsPopup.");this.__confirmButton=o;let s=this.__confirmButton.getElement()[0];s.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-button"),s.classList.add("tchmi-event-grid-template-confirm-button"),this.__elementFooter.appendChild(s),this.__eventDestroyers.push(e.EventProvider.register(this.__confirmButton.getId()+".onPressed",()=>{this.__event&&e.Server.Events.isAlarm(this.__event)&&e.Server.Events.confirmAlarm(this.__event,t=>{t.error!==e.Errors.NONE&&(TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.__parentControl.getId()+"] Unable to confirm alarm with id "+this.__event.id+" in domain "+this.__event.domain+": "+e.Log.buildMessage(t.details)),"object"==typeof t.details&&null!==t.details&&t.details.code===e.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__parentControl.__setCanConfirm(!1))})})),this.__elementFooter.appendChild(n.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(n.getId()+".onPressed",()=>this.hide())),this.__setCanConfirm(this.__parentControl.__getCanConfirm())}update(t){this.__event=t;let i=document.createDocumentFragment(),o=document.createElement("dl");i.appendChild(o);let n=function(e,t){let i=document.createElement("dt");i.textContent=tchmi_decode_control_characters(e),o.appendChild(i);let n=document.createElement("dd");n.textContent=t?tchmi_decode_control_characters(t):"-",o.appendChild(n)},s=t=>{let i=document.createElement("dl");for(let o in t)if(t.hasOwnProperty(o)){let n=document.createElement("dt");i.appendChild(n),n.textContent=o.slice(0,1).toUpperCase()+o.slice(1).replace(/([A-Z]+)/g," $1");let r=document.createElement("dd");i.appendChild(r);let l=t[o];if(null==l||""===l)r.textContent="-";else if(l instanceof Date)r.textContent=e.Localization.formatDate(l);else if("object"==typeof l)r.appendChild(s(l));else if("string"==typeof l){let e=null;try{e=JSON.parse(l)}catch(e){}e&&"object"==typeof e?r.appendChild(s(e)):r.textContent=tchmi_decode_control_characters(l)}else r.textContent=l}return i};n("Domain",t.domain),t.type!==e.Server.Events.Type.Payload&&(n("Source Domain",t.sourceDomain),n("Text",t.text)),n("Name",t.name);let r="";switch(t.type){case e.Server.Events.Type.Message:r="Message";break;case e.Server.Events.Type.Alarm:r="Alarm";break;case e.Server.Events.Type.Payload:r="Payload"}if(n("Type",r),t.type!==e.Server.Events.Type.Payload){let i="";switch(t.severity){case e.Server.Events.Severity.Verbose:i="Verbose";break;case e.Server.Events.Severity.Info:i="Info";break;case e.Server.Events.Severity.Warning:i="Warning";break;case e.Server.Events.Severity.Error:i="Error";break;case e.Server.Events.Severity.Critical:i="Critical"}if(n("Severity",i),t.type===e.Server.Events.Type.Alarm){let i="";switch(t.alarmState){case e.Server.Events.AlarmState.Raised:i="Raised";break;case e.Server.Events.AlarmState.Confirmed:i="Confirmed";break;case e.Server.Events.AlarmState.Cleared:i="Cleared";break;case e.Server.Events.AlarmState.ClearedAndConfirmed:i="Cleared and Confirmed";break;case e.Server.Events.AlarmState.Invalid:i="Invalid"}t.confirmationState!==e.Server.Events.ConfirmationState.NotRequired&&t.confirmationState!==e.Server.Events.ConfirmationState.NotSupported||(i+=", no confirmation needed"),n("Alarm State",i)}n("Raised",e.Localization.formatDate(t.timeRaised)),t.type===e.Server.Events.Type.Alarm?(void 0!==t.timeCleared&&null!==t.timeCleared&&t.timeCleared.valueOf()>0?n("Cleared",e.Localization.formatDate(t.timeCleared)):n("Cleared",""),void 0!==t.timeConfirmed&&null!==t.timeConfirmed&&t.timeConfirmed.valueOf()>0?n("Confirmed",e.Localization.formatDate(t.timeConfirmed)):n("Confirmed",""),this.__confirmButton.setIsEnabled(t.confirmationState===e.Server.Events.ConfirmationState.WaitForConfirmation)):this.__confirmButton.setIsEnabled(!1)}else n("Received",e.Localization.formatDate(t.timeReceived)),this.__confirmButton.setIsEnabled(!1);if(t.type!==e.Server.Events.Type.Payload){let e=document.createElement("dt");o.appendChild(e),e.textContent="Parameters";let i=document.createElement("dd");o.appendChild(i),t.params&&Object.keys(t.params).length>0?i.appendChild(s(t.params)):i.textContent="-"}else{let i=document.createElement("dt");o.appendChild(i),i.textContent="Parameters";let n=document.createElement("dd");o.appendChild(n),void 0!==t.payload&&null!==t.payload?t.payload instanceof Date?n.textContent=e.Localization.formatDate(t.payload):"object"==typeof t.payload?n.appendChild(s(t.payload)):n.textContent=t.payload:n.textContent="-"}this.__elementContent.textContent="",this.__elementContent.appendChild(i)}getEvent(){return this.__event}__setCanConfirm(e){this.__confirmButton.getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!e),this.__confirmButton.getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!e),this.__confirmButton.setIsEnabled(e)}}t.DetailsPopup=i}(i=t.TcHmiEventGridPopups||(t.TcHmiEventGridPopups={}))}(i=t.Beckhoff||(t.Beckhoff={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={})),function(e){let t;!function(t){let i;!function(i){let o;!function(i){class o extends i.Popup{constructor(i,o){if(super(i,"confirmAllPopup",o),this.__alarms=[],this.__elementAlarmCount=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup-alarm-count")[0],!this.__elementAlarmCount)throw new Error("Invalid Template.html");let n=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",`${this.__parentControl.getId()}.${this.__name}.datagrid`,{"data-tchmi-src-column":[{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:26,width:26,source:t.getBasePathEx(o)+"/Themes/Base/Images/critical.svg"}]},{name:"timeRaised",label:"Raised",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center"},{name:"text",label:"Text",control:"TextBlock",width:300,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,horizontalAlignment:"Left",verticalAlignment:"Center"}]},this.__parentControl),s=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.confirmButton`,{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":"Yes, confirm all alarms","data-tchmi-tooltip":"Confirm all displayed alarms and close the popup","data-tchmi-is-enabled":!1},this.__parentControl),r=e.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.closeButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"Cancel","data-tchmi-tooltip":"Close the popup without confirming any alarm"},this.__parentControl);if(!n||!s||!r)throw new Error("Could not create controls for ConfirmAllPopup.");this.__datagrid=n,this.__yesButton=s,this.__elementContent.appendChild(this.__datagrid.getElement()[0]),this.__elementFooter.appendChild(s.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(s.getId()+".onPressed",()=>{for(let t=0,i=this.__alarms.length;t<i;t++)e.Server.Events.confirmAlarm(this.__alarms[t],t=>{t.error!==e.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&e.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.__parentControl.getId()+"] Unable to confirm alarm: "+e.Log.buildMessage(t.details)),"object"==typeof t.details&&null!==t.details&&t.details.code===e.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__parentControl.__setCanConfirm(!1)});this.hide()})),this.__elementFooter.appendChild(r.getElement()[0]),this.__eventDestroyers.push(e.EventProvider.register(r.getId()+".onPressed",()=>this.hide()))}update(e){this.__alarms=e,this.__datagrid.setSrcData(this.__alarms),this.__yesButton.setIsEnabled(this.__alarms.length>0),this.__alarms.length>1?this.__elementAlarmCount.textContent="these "+this.__alarms.length+" alarms":0===this.__alarms.length?this.__elementAlarmCount.textContent="these alarms":this.__elementAlarmCount.textContent="this alarm",this.__elementContent.style.height=30*this.__alarms.length+70+"px"}getAlarms(){return this.__alarms}}i.ConfirmAllPopup=o}(o=i.TcHmiEventGridPopups||(i.TcHmiEventGridPopups={}))}(i=t.Beckhoff||(t.Beckhoff={}))}(t=e.Controls||(e.Controls={}))}(TcHmi||(TcHmi={}));